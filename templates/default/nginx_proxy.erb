# Proxy all requests to port <%= @http_port %>
server {
        listen        80 default;
        server_name   localhost;
        keepalive_timeout <%= @keepalive_timeout %>;
        access_log  <%= @log_dir %>/nginx_proxy.access.log;
  error_log   <%= @log_dir %>/nginx_proxy_ssl.error.log warn;

location /agent.tar.gz { root <%= node[:cassandra][:opscenter_home] %>-<%= node[:cassandra][:opscenter][:version] %> ; }

        location / {
            proxy_pass http://<%= @target_host %>:<%= @http_port %>;
            proxy_redirect off;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_connect_timeout <%= @proxy_connect_timeout %>;
            proxy_read_timeout <%= @proxy_read_timeout %>;
            proxy_send_timeout <%= @proxy_send_timeout %>;
            proxy_max_temp_file_size <%= @proxy_max_temp_file_size %>;
            proxy_temp_file_write_size <%= @proxy_temp_file_write_size %>;
            proxy_buffer_size <%= @proxy_buffer_size %>;
            proxy_busy_buffers_size <%= @proxy_busy_buffers_size %>;
            proxy_buffers <%= @proxy_buffers %>;
            proxy_buffering <%= @proxy_buffering %>;
        }

}


# HTTPS ----------------------------------------------------------->
server {

        access_log  <%= @log_dir %>/nginx_proxy_ssl.access.log;
  error_log   <%= @log_dir %>/nginx_proxy_ssl.error.log warn;

  listen         443 default;
  server_name    localhost;
  keepalive_timeout <%= @keepalive_timeout %>;
  ssl on;
  ssl_certificate <%= @ssl_cert %>;
  ssl_certificate_key  <%= @ssl_cert_key %>;

location /agent.tar.gz { root <%= node[:cassandra][:opscenter_home] %>-<%= node[:cassandra][:opscenter][:version] %> ; }

        location / {
            proxy_pass http://<%= @target_host %>:<%= @https_port %>;
            proxy_redirect off;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_connect_timeout <%= @proxy_connect_timeout %>;
            proxy_read_timeout <%= @proxy_read_timeout %>;
            proxy_send_timeout <%= @proxy_send_timeout %>;
            proxy_max_temp_file_size <%= @proxy_max_temp_file_size %>;
            proxy_temp_file_write_size <%= @proxy_temp_file_write_size %>;
            proxy_buffer_size <%= @proxy_buffer_size %>;
            proxy_busy_buffers_size <%= @proxy_busy_buffers_size %>;
            proxy_buffers <%= @proxy_buffers %>;
            proxy_buffering <%= @proxy_buffering %>;
        }
 
}
